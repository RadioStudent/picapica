// Generated by CoffeeScript 2.6.1
(function() {
  var Suggestion, transform;

  transform = function(data, $filter) {
    var highlights, i, key, len, prepend, ref, ref1, ref2, result, results, type, value;
    results = angular.fromJson(data);
    for (key in results) {
      value = results[key];
      if (results[key].length > 0 && key !== 'query') {
        type = key.slice(0, -1);
        ref = results[key];
        for (i = 0, len = ref.length; i < len; i++) {
          result = ref[i];
          result.type = type;
          prepend = result.type === 'artist' ? '' : `${result.albumArtistName} - `;
          if (((ref1 = result.elastica_highlights['name.autocomplete']) != null ? ref1.length : void 0) > 0) {
            highlights = result.elastica_highlights['name.autocomplete'];
          }
          result.label = `${$filter('icon')(result.type)}<span>${prepend}${highlights || result.name}</span>`;
        }
        results[key].push({
          searchInField: true,
          type: type,
          name: results.query,
          label: `All tracks with ${type} “<strong>${results.query}</strong>”`
        });
      }
    }
    results = results.artists.concat(results.albums, results.tracks);
    if ((ref2 = results[results.length - 1]) != null) {
      ref2.last = true;
    }
    return results;
  };

  Suggestion = function($resource, $filter) {
    return $resource('api/v1/ac', null, {
      query: {
        isArray: true,
        transformResponse: function(data) {
          return transform(data, $filter);
        }
      }
    });
  };

  module.exports = Suggestion;

}).call(this);
